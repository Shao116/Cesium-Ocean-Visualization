<!DOCTYPE html>
<html>
<head>
    <title>太平洋洋流可视化 | 上海海洋大学</title>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="./libs/Cesium/Widgets/widgets.css" />
    <script type="text/javascript" src="./libs/Cesium/Cesium.js"></script>
    <script src="./libs/axios.min.js"></script>
    <script src="./libs/three.min.js"></script>
    <script src="./libs/Tween.min.js"></script>
    <script src="./libs/howler.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #00f2fe;
            --secondary-color: #4facfe;
            --accent-color: #64ffda;
            --error-color: #ff4757;
            --dark-bg: #0a192f;
            --darker-bg: #020c1b;
            --panel-bg: rgba(10, 25, 47, 0.85);
            --panel-border: rgba(100, 255, 218, 0.2);
            --text-primary: #e6f1ff;
            --text-secondary: rgba(230, 241, 255, 0.7);
        }
        
        body {
            margin: 0;
            overflow: hidden;
            background: var(--dark-bg);
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            font-family: 'Rajdhani', 'Arial', sans-serif;
        }
        #map {
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 1.5s ease-in-out;
        }
        
        .header {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 999;
            color: var(--primary-color);
            text-shadow: 0 0 10px rgba(0, 242, 254, 0.7);
            font-family: 'Orbitron', sans-serif;
            background: var(--panel-bg);
            padding: 15px 25px;
            border-radius: 10px;
            border: 1px solid var(--panel-border);
            box-shadow: 0 0 30px rgba(0, 242, 254, 0.1);
            backdrop-filter: blur(5px);
            transform: translateY(-100px);
            opacity: 0;
            transition: all 1s ease-out 0.5s;
        }
        .title {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 5px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 1px;
        }
        .subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            letter-spacing: 2px;
        }
        
        .timeline {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 999;
            background: var(--panel-bg);
            padding: 15px;
            border-radius: 10px;
            min-width: 300px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--panel-border);
            backdrop-filter: blur(5px);
            transform: translateX(100px);
            opacity: 0;
            transition: all 1s ease-out 0.7s;
        }
        .timeline-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: var(--accent-color);
            font-size: 14px;
            font-weight: 500;
            letter-spacing: 1px;
        }
        .timeline-slider {
            width: 100%;
            height: 6px;
            -webkit-appearance: none;
            background: rgba(100, 255, 218, 0.2);
            border-radius: 3px;
            outline: none;
            margin: 10px 0;
            background: linear-gradient(90deg, var(--darker-bg), var(--primary-color), var(--darker-bg));
            background-size: 200% 100%;
            animation: sliderPulse 3s infinite linear;
        }
        @keyframes sliderPulse {
            0% { background-position: 100% 0; }
            100% { background-position: -100% 0; }
        }
        .timeline-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0, 242, 254, 0.7);
            transition: transform 0.2s;
        }
        .timeline-slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }
        .timeline-dates {
            display: flex;
            justify-content: space-between;
            color: var(--text-secondary);
            font-size: 12px;
        }
        .current-date {
            text-align: center;
            margin-top: 5px;
            color: var(--primary-color);
            font-size: 16px;
            font-weight: bold;
            font-family: 'Orbitron', sans-serif;
        }
        
        .data-source-panel {
            position: absolute;
            bottom: 20px;
            left: 20px;
            z-index: 999;
            background: var(--panel-bg);
            padding: 15px;
            border-radius: 10px;
            width: 300px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--panel-border);
            backdrop-filter: blur(5px);
            transform: translateY(100px);
            opacity: 0;
            transition: all 1s ease-out 0.9s;
        }
        .panel-title {
            color: var(--accent-color);
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            letter-spacing: 1px;
        }
        .panel-title:before {
            content: "";
            display: inline-block;
            width: 10px;
            height: 10px;
            background: var(--primary-color);
            margin-right: 10px;
            border-radius: 50%;
            box-shadow: 0 0 10px var(--primary-color);
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.3; }
            100% { opacity: 1; }
        }
        .data-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .data-option:hover {
            background: rgba(0, 242, 254, 0.1);
            box-shadow: 0 0 10px rgba(0, 242, 254, 0.2);
        }
        .data-option.active {
            background: rgba(0, 242, 254, 0.2);
            border-left: 3px solid var(--primary-color);
        }
        .data-label {
            color: var(--text-primary);
            font-weight: 500;
        }
        .data-date {
            color: var(--text-secondary);
            font-size: 12px;
        }
        .data-status {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #555;
        }
        .data-option.active .data-status {
            background: var(--primary-color);
            box-shadow: 0 0 10px var(--primary-color);
        }
        
        /* 右下角状态面板 */
        .status-panel {
            position: absolute;
            bottom: 20px;
            right: 20px;
            z-index: 999;
            background: var(--panel-bg);
            padding: 15px;
            border-radius: 10px;
            width: 250px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--panel-border);
            backdrop-filter: blur(5px);
            transform: translateX(100px);
            opacity: 0;
            transition: all 1s ease-out 1.1s;
        }
        .status-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        .status-label {
            color: var(--text-secondary);
            font-size: 13px;
        }
        .status-value {
            color: var(--text-primary);
            font-weight: 500;
            font-family: 'Orbitron', sans-serif;
            font-size: 13px;
        }
        .status-value.online {
            color: var(--accent-color);
        }
        .status-value.offline {
            color: var(--error-color);
        }
        .status-value.error {
            color: var(--error-color);
            animation: blink 1s infinite;
        }
        @keyframes blink {
            0% { opacity: 1; }
            50% { opacity: 0.3; }
            100% { opacity: 1; }
        }
        
        /* 扫描线效果 */
        .scanlines {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                to bottom,
                rgba(255,255,255,0) 0%,
                rgba(255,255,255,0) 50%,
                rgba(0,242,254,0.03) 51%,
                rgba(0,242,254,0.05) 100%
            );
            background-size: 100% 8px;
            z-index: 9999;
            pointer-events: none;
            opacity: 0.3;
            animation: scanline 8s linear infinite;
        }
        @keyframes scanline {
            0% { transform: translateY(0); }
            100% { transform: translateY(100vh); }
        }
        
        /* 3D粒子背景 */
        #particles-js {
            position: absolute;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
        
        /* 加载动画 */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--darker-bg);
            z-index: 99999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 1s;
        }
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(0, 242, 254, 0.2);
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
            position: relative;
        }
        .loading-spinner:after {
            content: "";
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            border: 5px solid transparent;
            border-top-color: var(--secondary-color);
            border-radius: 50%;
            animation: spin 1.5s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .loading-text {
            color: var(--text-primary);
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 2px;
            margin-top: 20px;
            text-align: center;
        }
        .loading-progress {
            width: 200px;
            height: 3px;
            background: rgba(0, 242, 254, 0.1);
            margin-top: 20px;
            overflow: hidden;
            border-radius: 3px;
        }
        .loading-progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            transition: width 0.3s;
            position: relative;
            overflow: hidden;
        }
        .loading-progress-bar:after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255,255,255,0.8), 
                transparent);
            animation: progressShine 2s infinite;
        }
        @keyframes progressShine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        /* 脉冲光点 */
        .pulse-dot {
            position: absolute;
            width: 10px;
            height: 10px;
            background: var(--primary-color);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--primary-color);
            animation: pulse 2s infinite;
            z-index: 999;
        }
        
        /* 数据可视化图表 */
        .chart-container {
            position: absolute;
            top: 150px;
            left: 20px;
            z-index: 999;
            background: var(--panel-bg);
            padding: 15px;
            border-radius: 10px;
            width: 300px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--panel-border);
            backdrop-filter: blur(5px);
            transform: translateY(-100px);
            opacity: 0;
            transition: all 1s ease-out 0.8s;
        }
        .chart-title {
            color: var(--accent-color);
            font-size: 14px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        .chart {
            width: 100%;
            height: 120px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            overflow: hidden;
            position: relative;
        }
        .chart-line {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 1px;
            background: rgba(100, 255, 218, 0.3);
        }
        .chart-data {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: flex-end;
        }
        .chart-bar {
            flex: 1;
            background: linear-gradient(to top, var(--primary-color), var(--secondary-color));
            margin: 0 1px;
            opacity: 0.7;
            transition: height 0.5s;
        }
        
        /* 错误提示 */
        .error-toast {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 71, 87, 0.9);
            color: white;
            padding: 20px 30px;
            border-radius: 8px;
            z-index: 99999;
            font-family: 'Rajdhani', sans-serif;
            font-weight: 500;
            box-shadow: 0 10px 30px rgba(255, 71, 87, 0.3);
            display: flex;
            align-items: center;
            opacity: 0;
            transition: all 0.3s;
            pointer-events: none;
        }
        .error-toast.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1.05);
        }
        .error-toast:before {
            content: "!";
            display: inline-block;
            width: 24px;
            height: 24px;
            background: white;
            color: var(--error-color);
            border-radius: 50%;
            text-align: center;
            line-height: 24px;
            font-weight: bold;
            margin-right: 10px;
        }
        
        /* 全屏转场效果 */
        .transition-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--darker-bg);
            z-index: 999999;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.8s;
        }
        .transition-screen.active {
            opacity: 1;
            pointer-events: all;
        }
        .transition-text {
            color: var(--primary-color);
            font-family: 'Orbitron', sans-serif;
            font-size: 24px;
            letter-spacing: 5px;
            text-align: center;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s;
        }
        .transition-screen.active .transition-text {
            opacity: 1;
            transform: translateY(0);
        }
        .transition-progress {
            width: 200px;
            height: 2px;
            background: rgba(0, 242, 254, 0.2);
            margin-top: 30px;
            position: relative;
            overflow: hidden;
        }
        .transition-progress:after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            transition: width 0.5s;
        }
        
        /* 数字雨效果 */
        .matrix-rain {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.1;
            pointer-events: none;
        }

        /* 洋流导航栏 */
        .currents-nav {
            position: absolute;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            z-index: 999;
            background: var(--panel-bg);
            padding: 15px;
            border-radius: 10px;
            width: 200px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--panel-border);
            backdrop-filter: blur(5px);
            transform: translateY(-50%) translateX(100px);
            opacity: 0;
            transition: all 1s ease-out 0.8s;
        }
        .currents-nav-title {
            color: var(--accent-color);
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            letter-spacing: 1px;
        }
        .current-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .current-item:hover {
            background: rgba(0, 242, 254, 0.1);
            box-shadow: 0 0 10px rgba(0, 242, 254, 0.2);
        }
        .current-name {
            color: var(--text-primary);
            font-weight: 500;
        }
        .current-name-en {
            color: var(--text-secondary);
            font-size: 12px;
            margin-top: 2px;
        }
        .current-arrow {
            color: var(--primary-color);
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .current-item:hover .current-arrow {
            opacity: 1;
        }

        /* 语言切换按钮 */
        .language-switcher {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 999;
            background: var(--panel-bg);
            padding: 8px 15px;
            border-radius: 20px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--panel-border);
            backdrop-filter: blur(5px);
            display: flex;
            gap: 10px;
            transform: translateX(-50%) translateY(-100px);
            opacity: 0;
            transition: all 1s ease-out 0.6s;
        }
        .language-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-family: 'Rajdhani', sans-serif;
            font-weight: 500;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 15px;
            transition: all 0.3s;
        }
        .language-btn.active {
            background: rgba(0, 242, 254, 0.2);
            color: var(--primary-color);
            font-weight: bold;
        }
        .language-btn:hover {
            color: var(--text-primary);
        }
    </style>
</head>
<body>
    <!-- 加载动画 -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">OCEAN CURRENT VISUALIZATION</div>
        <div class="loading-text" style="font-size:12px;">INITIALIZING QUANTUM SYSTEM...</div>
        <div class="loading-progress">
            <div class="loading-progress-bar" id="loadingProgress"></div>
        </div>
    </div>
    
    <!-- 转场效果 -->
    <div class="transition-screen" id="transitionScreen">
        <div>
            <div class="transition-text" id="transitionText">LOADING DATA STREAM</div>
            <div class="transition-progress" id="transitionProgress"></div>
        </div>
    </div>
    
    <!-- 3D粒子背景 -->
    <div id="particles-js"></div>
    
    <!-- 数字雨背景 -->
    <canvas class="matrix-rain" id="matrixRain"></canvas>
    
    <!-- 地图容器 -->
    <div id="map"></div>
    
    <!-- 扫描线效果 -->
    <div class="scanlines"></div>
    
    <!-- 科技感标题 -->
    <div class="header">
        <div class="title">OCEAN CURRENT VISUALIZATION</div>
        <div class="subtitle">全球洋流动态量子可视化系统 | 上海海洋大学</div>
    </div>
    
    <!-- 语言切换 -->
    <div class="language-switcher">
        <button class="language-btn active" data-lang="zh">中文</button>
        <button class="language-btn" data-lang="en">English</button>
    </div>
    
    <!-- 时间轴控件 -->
    <div class="timeline">
        <div class="timeline-header">
            <span class="lang-zh">洋流时间轴</span>
            <span class="lang-en">Current Timeline</span>
            <span id="currentMonth">2023年9月</span>
        </div>
        <input type="range" min="1" max="30" value="15" class="timeline-slider" id="timelineSlider">
        <div class="timeline-dates">
            <span class="lang-zh">1日</span>
            <span class="lang-en">1st</span>
            <span class="lang-zh">15日</span>
            <span class="lang-en">15th</span>
            <span class="lang-zh">30日</span>
            <span class="lang-en">30th</span>
        </div>
        <div class="current-date" id="currentDate">2023-09-15</div>
    </div>
    
    <!-- 洋流导航栏 -->
    <div class="currents-nav">
        <div class="currents-nav-title lang-zh">主要洋流导航</div>
        <div class="currents-nav-title lang-en" style="display:none;">Major Currents</div>
        
        <div class="current-item" data-lon="150" data-lat="20" data-zoom="3000000">
            <div>
                <div class="current-name lang-zh">黑潮</div>
                <div class="current-name lang-en" style="display:none;">Kuroshio Current</div>
                <div class="current-name-en">Kuroshio</div>
            </div>
            <div class="current-arrow">→</div>
        </div>
        
        <div class="current-item" data-lon="-150" data-lat="20" data-zoom="3000000">
            <div>
                <div class="current-name lang-zh">北太平洋暖流</div>
                <div class="current-name lang-en" style="display:none;">North Pacific Current</div>
                <div class="current-name-en">North Pacific</div>
            </div>
            <div class="current-arrow">→</div>
        </div>
        
        <div class="current-item" data-lon="-110" data-lat="0" data-zoom="4000000">
            <div>
                <div class="current-name lang-zh">赤道逆流</div>
                <div class="current-name lang-en" style="display:none;">Equatorial Counter Current</div>
                <div class="current-name-en">Equatorial Counter</div>
            </div>
            <div class="current-arrow">→</div>
        </div>
        
        <div class="current-item" data-lon="-80" data-lat="-10" data-zoom="4000000">
            <div>
                <div class="current-name lang-zh">秘鲁寒流</div>
                <div class="current-name lang-en" style="display:none;">Peru Current</div>
                <div class="current-name-en">Peru Current</div>
            </div>
            <div class="current-arrow">→</div>
        </div>
    </div>
    
    <!-- 数据源切换面板 -->
    <div class="data-source-panel">
        <div class="panel-title lang-zh">数据源选择</div>
        <div class="panel-title lang-en" style="display:none;">Data Source</div>
        <div class="data-option active" data-url="./libs/datas/202309.json">
            <div>
                <div class="data-label lang-zh">2023年9月数据集</div>
                <div class="data-label lang-en" style="display:none;">September 2023 Dataset</div>
                <div class="data-date lang-zh">更新于2023-10-15</div>
                <div class="data-date lang-en" style="display:none;">Updated 2023-10-15</div>
            </div>
            <div class="data-status"></div>
        </div>
        <div class="data-option" data-url="./libs/datas/202307.json">
            <div>
                <div class="data-label lang-zh">2023年7月数据集</div>
                <div class="data-label lang-en" style="display:none;">July 2023 Dataset</div>
                <div class="data-date lang-zh">更新于2023-08-10</div>
                <div class="data-date lang-en" style="display:none;">Updated 2023-08-10</div>
            </div>
            <div class="data-status"></div>
        </div>
    </div>
    
    <!-- 右下角状态面板 -->
    <div class="status-panel">
        <div class="status-item">
            <span class="status-label lang-zh">系统状态</span>
            <span class="status-label lang-en" style="display:none;">System Status</span>
            <span class="status-value online">ONLINE</span>
        </div>
        <div class="status-item">
            <span class="status-label lang-zh">数据加载</span>
            <span class="status-label lang-en" style="display:none;">Data Load</span>
            <span class="status-value" id="dataLoadStatus">0%</span>
        </div>
        <div class="status-item">
            <span class="status-label lang-zh">渲染帧率</span>
            <span class="status-label lang-en" style="display:none;">FPS</span>
            <span class="status-value" id="fpsCounter">-- FPS</span>
        </div>
        <div class="status-item">
            <span class="status-label lang-zh">内存使用</span>
            <span class="status-label lang-en" style="display:none;">Memory</span>
            <span class="status-value" id="memoryUsage">-- GB</span>
        </div>
    </div>
    
    <!-- 左上角装饰元素 -->
    <div class="corner-decor top-left"></div>
    <div class="corner-decor top-right"></div>
    <div class="corner-decor bottom-left"></div>
    <div class="corner-decor bottom-right"></div>
    
    <!-- 脉冲光点 -->
    <div class="pulse-dot" style="top: 30px; right: 30px;"></div>
    <div class="pulse-dot" style="bottom: 30px; left: 30px;"></div>
    
    <!-- 数据可视化图表 -->
    <div class="chart-container">
        <div class="chart-title lang-zh">洋流速度分布 (m/s)</div>
        <div class="chart-title lang-en" style="display:none;">Current Speed Distribution (m/s)</div>
        <div class="chart">
            <div class="chart-line"></div>
            <div class="chart-data" id="speedChart"></div>
        </div>
    </div>
    
    <!-- 错误提示 -->
    <div class="error-toast" id="errorToast">数据加载失败，请检查网络连接</div>

    <script type="module">

        // 模拟加载进度
        let progress = 0;
        const loadingInterval = setInterval(() => {
            progress += Math.random() * 10;
            if (progress >= 100) {
                progress = 100;
                clearInterval(loadingInterval);
                setTimeout(() => {
                    document.getElementById('loadingOverlay').style.opacity = '0';
                    setTimeout(() => {
                        document.getElementById('loadingOverlay').style.display = 'none';
                        // 显示主界面
                        document.getElementById('map').style.opacity = '1';
                        // 显示所有UI元素
                        document.querySelectorAll('.header, .timeline, .data-source-panel, .status-panel, .chart-container, .currents-nav, .language-switcher').forEach(el => {
                            el.style.transform = 'translate(0)';
                            el.style.opacity = '1';
                        });
                    }, 1000);
                }, 500);
            }
            document.getElementById('loadingProgress').style.width = progress + '%';
        }, 100);
        
        // 显示错误提示
        function showError(message) {
            const toast = document.getElementById('errorToast');
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
            
            // 更新状态面板
            document.querySelector('.status-value.online').textContent = 'ERROR';
            document.querySelector('.status-value.online').className = 'status-value error';
        }
        
        // 初始化数字雨效果
        function initMatrixRain() {
            const canvas = document.getElementById('matrixRain');
            const ctx = canvas.getContext('2d');
            
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            const katakana = 'アァカサタナハマヤャラワガザダバパイィキシチニヒミリヰギジヂビピウゥクスツヌフムユュルグズブヅプエェケセテネヘメレヱゲゼデベペオォコソトノホモヨョロヲゴゾドボポヴッン';
            const latin = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            const nums = '0123456789';
            
            const alphabet = katakana + latin + nums;
            
            const fontSize = 16;
            const columns = canvas.width / fontSize;
            
            const rainDrops = [];
            
            for (let x = 0; x < columns; x++) {
                rainDrops[x] = 1;
            }
            
            const draw = () => {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                ctx.fillStyle = '#0F0';
                ctx.font = fontSize + 'px monospace';
                
                for (let i = 0; i < rainDrops.length; i++) {
                    const text = alphabet.charAt(Math.floor(Math.random() * alphabet.length));
                    ctx.fillText(text, i * fontSize, rainDrops[i] * fontSize);
                    
                    if (rainDrops[i] * fontSize > canvas.height && Math.random() > 0.975) {
                        rainDrops[i] = 0;
                    }
                    rainDrops[i]++;
                }
            };
            
            setInterval(draw, 30);
            
            window.addEventListener('resize', () => {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            });
        }
        
        initMatrixRain();
        
        // 初始化粒子背景
        function initParticles() {
            const canvas = document.createElement('canvas');
            canvas.style.position = 'absolute';
            canvas.style.top = '0';
            canvas.style.left = '0';
            canvas.style.width = '100%';
            canvas.style.height = '100%';
            canvas.style.zIndex = '-1';
            document.getElementById('particles-js').appendChild(canvas);
            
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            const particles = [];
            const particleCount = Math.floor(window.innerWidth * window.innerHeight / 10000);
            
            for (let i = 0; i < particleCount; i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    size: Math.random() * 2 + 0.5,
                    speed: Math.random() * 0.2 + 0.1,
                    opacity: Math.random() * 0.5 + 0.1,
                    direction: Math.random() * Math.PI * 2
                });
            }
            
            function animateParticles() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                for (let i = 0; i < particles.length; i++) {
                    const p = particles[i];
                    
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(0, 242, 254, ${p.opacity})`;
                    ctx.fill();
                    
                    p.x += Math.cos(p.direction) * p.speed;
                    p.y += Math.sin(p.direction) * p.speed;
                    
                    if (p.x < 0 || p.x > canvas.width || p.y < 0 || p.y > canvas.height) {
                        p.x = Math.random() * canvas.width;
                        p.y = Math.random() * canvas.height;
                        p.direction = Math.random() * Math.PI * 2;
                    }
                }
                
                requestAnimationFrame(animateParticles);
            }
            
            animateParticles();
            
            window.addEventListener('resize', () => {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            });
        }
        
        initParticles();
        
        // 初始化图表
        function initChart() {
            const chart = document.getElementById('speedChart');
            chart.innerHTML = '';
            
            for (let i = 0; i < 20; i++) {
                const bar = document.createElement('div');
                bar.className = 'chart-bar';
                bar.style.height = Math.random() * 100 + '%';
                chart.appendChild(bar);
            }
            
            setInterval(() => {
                const bars = document.querySelectorAll('.chart-bar');
                bars.forEach(bar => {
                    bar.style.height = Math.random() * 100 + '%';
                });
            }, 2000);
        }
        
        initChart();
        
        // 更新状态面板
        function updateStatus() {
            // 模拟帧率变化
            const fps = Math.floor(40 + Math.random() * 20);
            document.getElementById('fpsCounter').textContent = `${fps} FPS`;
            
            // 模拟内存使用
            const memory = (1 + Math.random() * 0.5).toFixed(1);
            document.getElementById('memoryUsage').textContent = `${memory} GB`;
            
            setTimeout(updateStatus, 2000);
        }
        
        updateStatus();
        
        // 语言切换功能
        function setupLanguageSwitcher() {
            const langBtns = document.querySelectorAll('.language-btn');
            
            langBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const lang = this.getAttribute('data-lang');
                    
                    // 更新按钮状态
                    langBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // 切换语言显示
                    if (lang === 'zh') {
                        document.querySelectorAll('.lang-zh').forEach(el => el.style.display = '');
                        document.querySelectorAll('.lang-en').forEach(el => el.style.display = 'none');
                    } else {
                        document.querySelectorAll('.lang-zh').forEach(el => el.style.display = 'none');
                        document.querySelectorAll('.lang-en').forEach(el => el.style.display = '');
                    }
                });
            });
        }
        
        setupLanguageSwitcher();
        
        // 将import语句移到模块顶部
        import LayerOceanCurrent from "./libs/LayerOceanCurrent/LayerOceanCurrent.js";
        
        Cesium.Ion.defaultAccessToken = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIzNjYzOTI5NC0yM2QyLTQyOTgtYWM5OS1lM2MwNTYwMGEzMjciLCJpZCI6ODQ1MjYsImlhdCI6MTY0NjM1ODM5OX0.BzsVR7Lt9RhsCia-R7E64KunaAME0HGD7Sv2-xF-RIQ";
        
        var viewer = new Cesium.Viewer("map", {
            geocoder: false,
            homeButton: false,
            sceneModePicker: false,
            baseLayerPicker: false,
            navigationHelpButton: false,
            animation: false,
            timeline: false,
            fullscreenButton: false,
            creditContainer: document.createElement("div"),
        });
        
        // 设置初始视角对准太平洋
        viewer.camera.flyTo({
            destination: Cesium.Cartesian3.fromDegrees(180, 0, 20000000),
            orientation: {
                heading: Cesium.Math.toRadians(0),
                pitch: Cesium.Math.toRadians(-90),
                roll: 0.0
            },
            duration: 0
        });
        
        // 设置科技感主题
        viewer.scene.backgroundColor = Cesium.Color.BLACK;
        viewer.scene.globe.baseColor = Cesium.Color.BLACK;
        viewer.scene.globe.enableLighting = true;
        
        viewer.scene.debugShowFramesPerSecond = true;

        var xyz = new Cesium.UrlTemplateImageryProvider({
            url: "./libs/SeaSpeed/{z}/{x}/{y}.png",
        });
        viewer.imageryLayers.addImageryProvider(xyz);
        
        let seaWave = null;
        let currentDataUrl = "./libs/datas/202309.json";
        
        // 显示转场效果
        function showTransition(message, callback) {
            const transitionScreen = document.getElementById('transitionScreen');
            const transitionText = document.getElementById('transitionText');
            const transitionProgress = document.getElementById('transitionProgress');
            
            transitionText.textContent = message;
            transitionScreen.classList.add('active');
            transitionProgress.style.width = '0%';
            
            // 模拟加载进度
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 20;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(interval);
                    transitionProgress.style.width = '100%';
                    setTimeout(() => {
                        transitionScreen.classList.remove('active');
                        if (callback) callback();
                    }, 500);
                }
                transitionProgress.style.width = progress + '%';
            }, 100);
        }
        
        function loadData(url) {
            showTransition('LOADING OCEAN DATA', () => {
                document.getElementById('dataLoadStatus').textContent = 'LOADING...';
                
                if (seaWave) {
                    viewer.entities.removeAll();
                }
                
                seaWave = new LayerOceanCurrent({});
                
                axios({
                    method: "get",
                    url: url,
                }).then((res) => {
                    if (!res.data || !res.data.data) {
                        throw new Error("Invalid data format");
                    }
                    
                    seaWave.load(res.data.data);
                    seaWave.addToMap(viewer);
                    document.getElementById('dataLoadStatus').textContent = '100%';
                    
                    // 更新图表数据
                    const bars = document.querySelectorAll('.chart-bar');
                    bars.forEach(bar => {
                        bar.style.height = Math.random() * 100 + '%';
                    });
                }).catch((err) => {
                    console.error("数据加载失败:", err);
                    document.getElementById('dataLoadStatus').textContent = 'ERROR';
                    showError(`数据加载失败: ${err.message}`);
                });
            });
        }
        
        // 初始加载数据
        loadData(currentDataUrl);
        
        // 数据源切换功能
        const dataOptions = document.querySelectorAll('.data-option');
        dataOptions.forEach(option => {
            option.addEventListener('click', function() {
                const url = this.getAttribute('data-url');
                if (url !== currentDataUrl) {
                    dataOptions.forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');
                    currentDataUrl = url;
                    
                    // 更新月份显示
                    const month = url.includes('202309') ? '2023年9月' : '2023年7月';
                    document.getElementById('currentMonth').textContent = month;
                    document.getElementById('currentDate').textContent = 
                        url.includes('202309') ? '2023-09-15' : '2023-07-15';
                    
                    loadData(url);
                    
                    // 飞向太平洋
                    viewer.camera.flyTo({
                        destination: Cesium.Cartesian3.fromDegrees(180, 0, 20000000),
                        orientation: {
                            heading: Cesium.Math.toRadians(0),
                            pitch: Cesium.Math.toRadians(-90),
                            roll: 0.0
                        },
                        duration: 1.5
                    });
                }
            });
        });
        
        // 时间轴交互功能
        const slider = document.getElementById('timelineSlider');
        const currentDate = document.getElementById('currentDate');
        
        slider.addEventListener('input', function() {
            const day = this.value.padStart(2, '0');
            const yearMonth = currentDataUrl.includes('202309') ? '2023-09' : '2023-07';
            currentDate.textContent = `${yearMonth}-${day}`;
            
            // 这里可以添加实际更新数据的代码
            // 例如: updateCurrentData(day);
        });
        
        // 添加一些动画效果
        document.querySelectorAll('.panel-title, .data-option, .status-item').forEach(el => {
            el.addEventListener('mouseenter', () => {
                el.style.transform = 'translateX(5px)';
            });
            el.addEventListener('mouseleave', () => {
                el.style.transform = 'translateX(0)';
            });
        });
        
        // 洋流导航功能
        function setupCurrentsNavigation() {
            const currentItems = document.querySelectorAll('.current-item');
            
            currentItems.forEach(item => {
                item.addEventListener('click', function() {
                    const lon = parseFloat(this.getAttribute('data-lon'));
                    const lat = parseFloat(this.getAttribute('data-lat'));
                    const zoom = parseFloat(this.getAttribute('data-zoom'));
                    
                    viewer.camera.flyTo({
                        destination: Cesium.Cartesian3.fromDegrees(lon, lat, zoom),
                        orientation: {
                            heading: Cesium.Math.toRadians(0),
                            pitch: Cesium.Math.toRadians(-45),
                            roll: 0.0
                        },
                        duration: 1.5
                    });
                    
                    // 添加脉冲光点标记
                    if (viewer.entities.getById('current-marker')) {
                        viewer.entities.removeById('current-marker');
                    }
                    
                    viewer.entities.add({
                        id: 'current-marker',
                        position: Cesium.Cartesian3.fromDegrees(lon, lat),
                        point: {
                            pixelSize: 20,
                            color: Cesium.Color.CYAN.withAlpha(0.8),
                            outlineColor: Cesium.Color.WHITE,
                            outlineWidth: 2,
                            disableDepthTestDistance: Number.POSITIVE_INFINITY
                        },
                        label: {
                            text: this.querySelector('.current-name').textContent,
                            font: '16px Orbitron',
                            style: Cesium.LabelStyle.FILL_AND_OUTLINE,
                            outlineWidth: 2,
                            verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                            pixelOffset: new Cesium.Cartesian2(0, -20),
                            disableDepthTestDistance: Number.POSITIVE_INFINITY
                        }
                    });
                    
                    // 添加脉冲动画
                    const pulseInterval = setInterval(() => {
                        const point = viewer.entities.getById('current-marker').point;
                        point.pixelSize = 20 + Math.sin(Date.now() / 300) * 10;
                    }, 30);
                    
                    // 5秒后移除标记
                    setTimeout(() => {
                        clearInterval(pulseInterval);
                        viewer.entities.removeById('current-marker');
                    }, 5000);
                });
            });
        }
        
        setupCurrentsNavigation();
        
        // 添加键盘快捷键
        document.addEventListener('keydown', (e) => {
            if (e.key === '1') {
                document.querySelector('.data-option[data-url="./libs/datas/202309.json"]').click();
            } else if (e.key === '2') {
                document.querySelector('.data-option[data-url="./libs/datas/202307.json"]').click();
            } else if (e.key === 'p') {
                // 飞向太平洋
                viewer.camera.flyTo({
                    destination: Cesium.Cartesian3.fromDegrees(180, 0, 20000000),
                    orientation: {
                        heading: Cesium.Math.toRadians(0),
                        pitch: Cesium.Math.toRadians(-90),
                        roll: 0.0
                    },
                    duration: 1.5
                });
            }
        });
        
        // 添加窗口大小变化监听
        window.addEventListener('resize', () => {
            // 保持太平洋在视野中心
            if (viewer) {
                viewer.camera.flyTo({
                    destination: Cesium.Cartesian3.fromDegrees(180, 0, viewer.camera.positionCartographic.height),
                    duration: 0.5
                });
            }
        });
    </script>
</body>
</html>